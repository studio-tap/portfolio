# 開発ログ

## 2025-07-27

### プロジェクトセットアップとVercelへのデプロイ
Dockerを使用してNext.jsの開発環境を構築した。`docker-compose.yml`と`Dockerfile`を適切に設定し、コンテナ内で`create-next-app`を実行。これにより、Next.jsの初期プロジェクトが作成され、Welcomeページが無事に表示された。

その後、Next.jsの開発元であるVercelについて学習。Vercelが提供するサーバーレスのホスティングプラットフォームの利点（Next.jsへの最適化、パフォーマンス、優れた開発体験など）を、従来のレンタルサーバーと比較しながら理解を深めた。

学習の一環として、作成したNext.jsプロジェクトをGitHubリポジトリ経由でVercelにデプロイし、正常に公開されていることを確認した。

### コンポーネント設計思想の確立
今後の開発方針として、Reactのコンポーネント設計について議論を開始した。

まず、UI設計手法であるAtomic Designについて検討。その概念は理解しつつも、化学由来の命名が直感的でない点や、各要素の粒度の区別が曖昧であるという課題が挙げられた。

そこで、これまでのWeb制作経験で培われたCSS設計（`base`, `layout`, `project`, `component`, `utility`）の考え方を応用し、より実践的で分かりやすい独自のコンポーネント設計ルールを模索することにした。

議論の結果、以下の様なディレクトリ構成と粒度のルールを仮説として立てた。これは、Atomic Designの思想の良い部分を取り入れつつ、命名の分かりにくさを解消することを目的としている。

#### コンポーネントのカテゴリ（`src/components`直下）
*   `/base`: グローバルなスタイルや基本的なHTML要素をラップするコンポーネント。
*   `/layout`: ヘッダーやフッターなど、ページの骨格を定義するコンポーネント。
*   `/ui`: 主要なUIを構成するコンポーネント群。粒度ごとのサブディレクトリを持つ。
*   `/feature`: 特定の機能に特化した、再利用性の低いコンポーネント。
*   `/utility`: 汎用的なヘルパーコンポーネント。

#### UIコンポーネントの粒度（`src/components/ui`配下）
*   **Atom（原子）**: `Button`, `Input`など、UIの最小単位。
*   **Module（モジュール）**: `SearchForm`など、複数のAtomを組み合わせた機能単位。
*   **Block（ブロック）**: `Header`など、ModuleやAtomを組み合わせたより複雑なセクション。

この設計思想を元に、今後の開発を進めていく方針を確認した。

## 2025-07-28

### 開発ログのルール確認
`DEVELOPMENT_LOG.md`に会話の記録を残すルールを再確認した。

### ディレクトリ構造の修正
`create-next-app`の実行によって意図せず生成された`src/app/src`という深い階層構造を修正。Next.jsプロジェクトのルートを`portfolio/src`に設定し直し、`docker-compose.yml`のパスも合わせて更新した。これにより、より標準的で管理しやすいディレクトリ構造になった。

### コンポーネント設計に関する再検討
ディレクトリ構造の議論から派生し、コンポーネント設計について再度検討を行った。Atomic DesignがUIのデザイン論であるのに対し、開発側の視点（再利用性、疎結合）をより重視した設計の必要性を確認。その中で、Feature-Based, Fractal-Based, Page-Basedなど、複数の有名なディレクトリ構造パターンについて学習し、それぞれの長所と短所を理解した。最終的に、Next.jsの標準的な構成である`src`をプロジェクトルートとすることに決定した。

### 動作確認とデプロイ設定
一連のディレクトリ構造の修正後、`docker-compose down`と`docker-compose up -d --build`を実行し、ローカル環境でNext.jsのWelcomeページが正常に表示されることを確認した。その後、変更内容を`git add .`でステージングし、「2025-07-28: ディレクトリ構造の全面的な見直しと正常化」というメッセージでコミット、リモートリポジトリへプッシュした。最後に、Vercelのプロジェクト設定において、Root Directoryを新しいプロジェクトルートである`src`に変更し、再デプロイを行うことで、本番環境にも変更を反映させた。

### コンポーネント設計の再々検討と方針転換
コンポーネント設計について再度議論を行った。ユーザーはAtomic Designに納得せず、汎用性、UI/ロジックの分離、明確な粒度を重視した独自の5段階ディレクトリ構造（`component`, `module`, `object`, `feature`, `page`）を提案した。

この提案に対し、私は各カテゴリの定義の厳密さ、特に「見た目だけ」のコンポーネントの維持の難しさや、`module`/`object`の役割の曖昧さ、過剰な抽象化による複雑性などの課題を指摘した。

議論の結果、ユーザーは「componentにロジックを含まない」ことの難しさや、自身の「非スタンドアロン」「スタンドアロン」の概念がReactのコンポーネント開発と完全にマッチしない可能性を認識した。

最終的に、概念的な議論を一旦中断し、実際にページを構築しながらReactでの最適な実装方法を探索する方針に転換することで合意した。

### Next.js App Routerの基本分析
Next.jsのWelcomeページがブラウザに表示されるまでのロジックとレンダリングの仕組みを分析した。`src/app/layout.tsx`がアプリケーション全体の骨格とメタデータを定義し、`src/app/page.tsx`がルートURLのコンテンツを定義していることを確認した。Next.jsがこれらをサーバーサイドでレンダリングし、HTMLとしてブラウザに送信するプロセスを理解した。

また、Next.js App Routerにおけるルーティングとレイアウトの概念について深く掘り下げた。具体的には、`layout.tsx`のネスト、`template.tsx`との違い、`page.tsx`の役割、フォルダ名によるルーティング定義、そしてグループルートによる共通レイアウトの適用方法について理解を深めた。

さらに、`layout.tsx`のインポートブロックについて詳細に分析し、`Metadata`が型定義であること、`Geist`や`Geist_Mono`がフォントローダー関数であることを確認した。Next.js App Routerでよく使われる型（`React.ReactNode`, `LayoutProps`など）についても理解を深めた。最後に、`Metadata`のような型と`Link`のようなランタイム値のインポートの違い、そして共通インポートをまとめるプラクティスについて議論した。

## 2025-08-03

### フォント比較ページの作成とDocker環境のトラブルシューティング

別の開発環境からの作業を開始。まず、ローカルにクローンした3つのコーディングフォント（`HackGen NF`, `Moralerspace`, `PlemolJP NF`）を比較・検討するための専用ページを作成することにした。

静的アセットの慣例に従い、`src/public/fonts`ディレクトリを作成し、そこにフォントファイルを配置。その後、Next.js App Routerの機能を利用して、`/app/lab/font/page.tsx`という新しいルートを作成した。このページでは、CSSの`@font-face`ルールを用いて各フォントを動的に読み込み、サンプルテキスト（アルファベット、記号、日本語）を複数のウェイトで表示させることで、視覚的な比較を可能にしている。

しかし、開発サーバーを起動しようとした際にDockerデーモンが実行されていない問題が発覚。ユーザーが最近経験したマルウェア誤検知バグと再インストールが原因である可能性が浮上した。

この問題に対処するため、Dockerの完全なクリーンアンインストールを実施。関連するアプリケーションファイル、設定、キャッシュ、コマンドラインツールをシステムからすべて削除した。一部ファイルの削除で権限エラーが発生したため、ユーザーに手動での削除を依頼し、完了を確認。これにより、Dockerをクリーンな状態で再インストールできる準備が整った。

### Docker/Git環境の再構築と問題解決

新しい環境で開発サーバーを起動しようとしたところ、`docker-compose up`が正常に完了しない問題が発生した。

まず、`docker-compose.yml`から不要な`version`属性を削除。しかし、コンテナが起動直後に終了する問題は解決しなかった。フォアグラウンドでコンテナを起動 (`docker-compose up`) してログを確認したところ、`sh: next: not found`というエラーが原因であることが判明した。

これは、`Dockerfile`内で`npm install`が実行されておらず、Next.jsの実行に必要な`node_modules`が存在しないためであった。`Dockerfile`を修正し、`package.json`のコピー後に`npm install`を実行するように変更した。

さらに、ローカルの`src`ディレクトリをマウントする際に、コンテナ内の`node_modules`が上書きされてしまう問題を特定。`docker-compose.yml`の`volumes`設定に匿名ボリュームを追加 (`- /app/node_modules`) することで、この問題を解決した。

一連の修正とイメージの再ビルド (`docker-compose up -d --build`) を経て、開発サーバーは無事に起動した。

続いて、`git push`ができない問題を解決。`git remote -v`でリモートリポジトリの設定に問題がないことを確認した後、`git push`を再試行したところ、認証情報の入力を求められた。これを完了させることで、無事にリモートリポジトリへのプッシュが成功した。

### フォントの選定と適用、不要ファイルの削除

フォント比較ページ (`/app/lab/font/page.tsx`) を用いて、複数のコーディングフォントを比較検討した。当初、`page.tsx`の文字列定義やクライアントコンポーネントの指定に関するエラーが発生したが、これらを修正し、フォント比較ページを正常に表示できるようになった。

比較の結果、`PlemolJP Console NF`をサイト全体のフォントとして採用することを決定した。これに伴い、不要となったフォント比較ページ (`/app/lab`) および、`HackGen`、`Moralerspace`の各フォントファイル (`src/public/fonts`配下) をプロジェクトから削除した。

サイト全体へのフォント適用のため、`src/app/layout.tsx`を修正。`next/font/local`を使用して`PlemolJP Console NF`のRegularとBoldを読み込み、`<body>`タグに適用するように変更した。これにより、サイト全体のフォントが`PlemolJP Console NF`に統一された。

最後に、`globals.css`を修正し、`--font-plemol-jp`というCSS変数を`body`の`font-family`として適用する予定である。
